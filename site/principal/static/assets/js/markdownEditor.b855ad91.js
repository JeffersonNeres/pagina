"use strict";var MarkdownEditor=function(e,t,r,n,u){function o(e){var r,n,t=e.querySelector(".markdownEditor-source"),o=e.querySelector(".markdownEditor-preview"),i=e.querySelector(".markdownEditor-preview-output");null!=t&&null!=o&&(r=function(){var t=arguments;return function(e){s.apply(null,t)}}(t,o,i),t.addEventListener("input",function(){var e=this,t=arguments;clearTimeout(n),n=setTimeout(function(){r.apply(e,t)},a?300:800)}),t.addEventListener("keydown",function(e){s(t,o,i)}),s(t,o,i),enableForumButtons())}function s(e,t,r){!function e(t,r,n){var o=t.value.replaceAll("[code]","```").replaceAll("[/code]","```");{var i;"undefined"!=typeof marked?(o=marked(o),DOMPurify.addHook("uponSanitizeElement",function(e,t){if("iframe"===t.tagName){t=e.getAttribute("src")||"";if(!t.startsWith("https://www.youtube.com/embed/")&&!t.startsWith("https://player.vimeo.com/video/"))return e.parentNode.removeChild(e)}}),i={ADD_TAGS:["iframe","p","img"],ADD_ATTR:["allow","allowfullscreen","frameborder","scrolling","onerror"]},o=DOMPurify.sanitize(o,i),r.innerHTML=o,n.value=o):setTimeout(function(){e(t,r,n)},300)}}(e,t,r)}String.prototype.replaceAll=String.prototype.replaceAll||function(e,t){return this.split(e).join(t)};for(var i,a=matchMedia("(min-width: 800px)").matches,l=document.querySelectorAll(".markdownEditor"),d=0;d<l.length;d++)o(l[d]),a&&null!=(i=l[d].querySelector(".markdownEditor-button-preview"))&&gnarus.buttonToggle.toggle(i);var m=new ImagesClient(e,t,r,n),e=$(".markdownEditor-button-image"),f=!1,c=0;function p(e){return $($(e.closest(".markdown-editor--wrapper")).children(".alert")[0])}function w(e){return e.find(".markdown-list-errors")}function g(e,t){var e=p(e),r=w(e);t&&r.append('<li class="alert-message">'.concat(t,"</li>")),e.removeClass("markdown-alert-error-hide"),e.addClass("markdown-alert-error")}function h(e){var t,r;f&&(t=p(e),r=w(t),setTimeout(function(){t.removeClass("markdown-alert-error"),t.addClass("markdown-alert-error-hide"),r.empty()},5e3),f=!1)}e.on("click",function(e){$(e.target).siblings(".markdownEditor-input-upload-images")[0].click()}),$(".markdownEditor-textArea").on("input",function(){$(".markdownEditor-preview").scrollTop($(".markdownEditor-preview")[0].scrollHeight)}),$(".markdownEditor-button-code").on("click",function(){var e=$(this.closest(".markdownEditor")).find(".markdownEditor-source"),t=$(e)[0],r=$(this).data("insert-code"),n="\n```\n";e.caret(n+r+n);n=e.caret()-n.length;e.caret(n),t.setSelectionRange(n-r.length,n)}),$(".markdownEditor-button-format").on("click",function(){Aria.expandingButton($(this)),"true"===$(this).attr("aria-expanded")&&$(".markdownEditor-help").on("animationend",function(){$(this).focus()})});function v(){var n=this,o=$(this)[0].files,e=$(this).data("image-limit-error"),i=$(this).data("image-file-not-allowed"),a=$(this).data("image-very-large"),l=$(this).data("image-malicious-file");if(5<o.length)return g(this,e),f=!0,h(this),void $(this).val("");for(var t=Array.from(o),d=$(this.closest(".markdownEditor")),c=new UploadProgress(u.imageUploadMessageProgress).markedEditor(d),r=(c.build(o),0);r<t.length;r++)!function(r){m.upload(t[r],c).then(function(e){var t=d.find(".markdownEditor-source"),r=d.find(".markdownEditor-preview"),n=d.find(".markdownEditor-preview-output"),e=u.imageUploadMessageTag.replace("#url#",e.paths[0]);t.caret(e),s(t[0],r[0],n[0])}).catch(function(e){f=!0;var t={"file-error":i.replace(/filename/,'"'.concat(o[r].name,'"')),"large-file":a.replace(/filename/,'"'.concat(o[r].name,'"')),"malicious-file":l.replace(/filename/,'"'.concat(o[r].name,'"'))};g(n,t[e.code]||null)}).finally(function(){r==t.length-1&&(c.reset(),h(n))})}(r)}return $(".markdownEditor-input-upload-images").on("change",function(){!function(n){var o=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5e3;(function(){if(!c){c=1;for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];n.apply(o,t),setTimeout(function(){c=0},i)}})()}(v.bind(this))}),{configure:o}};